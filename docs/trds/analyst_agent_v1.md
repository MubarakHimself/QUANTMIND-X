# Technical Requirements Document (TRD): Analyst Agent v1

## 1. Objective
The **Analyst Agent** is the "Strategy Architect" of the QuantMindX ecosystem. Its purpose is to ingest raw trading content (NPRD transcripts, articles) and synthesize it into high-precision Technical Requirements Documents (TRDs) for the **QuantCode Agent** to implement as MQL5 Expert Advisors.

---

## 2. Core Operational Flow (The Node Graph)

The agent operates as a **StateGraph** with the following specialized nodes:

### A. Stage 1: Strategy Ingestion (Synced NPRD Data)
*   **Source:** External transcripts/chunks generated by **Google Opal**, synced via Google Drive into a local directory (e.g., `data/nprd/`).
*   **Logic:** Scans for new strategy documents. It identifies core trading rules:
    *   **Entry Engine:** Indicators, Price Action triggers, Filters.
    *   **Management Engine:** Stop Loss (Fixed/ATR/Trail), Take Profit, Hedging logic.
    *   **Constraint Engine:** Preferred timeframes and session times.
*   **Context Link:** Maintains a reference to the source transcript path for the QuantCode agent.

### B. Stage 2: Knowledge Augmentation (The Librarian)
*   **Action:** Performs a Semantic Search across the QuantMindX Knowledge Base.
*   **Logic:** Finds technical "how-to" articles related to the extracted mechanics (e.g., "Best practices for MQL5 OrderSend for hedging strategies").

### C. Stage 3: Ecosystem Alignment (The Compliance Officer)
*   **Mission:** Ensures the strategy fits the "Standard Parent Bot" template.
*   **Mandatory Links:**
    *   **Python Socket Bridge:** Defines the JSON message schema for tick data (upstream) and trade commands (downstream).
    *   **Risk Governor:** Configures the bot to receive 0-100% "Allocation Scalars" from the `PropGovernor`.
    *   **Kelly Hook:** Defines which metrics the bot must report to satisfy the `EnhancedKellyCalculator`.

### D. Stage 4: TRD Synthesis & Handoff
*   **Output:** Generates a detailed "Final Strategy TRD."
*   **Requirement:** Must include clickable links to all source NPRD and KB documents for **QuantCode** context enrichment.

---

## 3. Human-In-The-Loop (HITL) Integration

To prevent hallucinations and ensure quality, the Analyst Agent includes built-in "Tagging" for review:

1.  **Draft Check:** When the TRD is complete, the agent issues a `ReviewRequest` tag.
2.  **User Loop:** The user reviews the document in the Chat UI.
3.  **Command:** The agent waits for a "Verified: Proceed to Coding" or "Adjust: [Feedback]" command.

---

## 4. Technical Integration

### Memory Management
*   **Short-Term:** LangGraph `ThreadState` for the current synthesis session.
*   **Long-Term (LangMem):** Stores user preferences (e.g., "I prefer ATR-based stops") and procedural learnings from previous bot designs.

### Communication Interface
*   **Removal of DLLs:** The TRD generated by the Analyst must assume a **pure Socket client** architecture in MQL5, communicating with the QuantMindX Python server.

---

## 5. Metadata & Traceability
Each TRD generated must contain a **"Context Header"**:
```markdown
# [Strategy Name] EA Technical Requirements
- Source NPRD: [Link](file://path/to/nprd)
- Research Articles: [Article 1], [Article 2]
- Ecosystem Version: QuantMindX v2.0
- Compliance Status: Standard Parent Bot Template
```
